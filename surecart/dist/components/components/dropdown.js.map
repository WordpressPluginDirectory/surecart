{"file":"dropdown.js","mappings":";;;;AAAA,MAAM,WAAW,GAAG,6mCAA6mC,CAAC;AACloC,yBAAe,WAAW;;ACK1B;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;cAwIU,UAAE;;;;;;;;;;;;cAaF,UAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["src/components/ui/dropdown/dropdown.scss?tag=sc-dropdown&encapsulation=shadow","src/components/ui/dropdown/dropdown.tsx"],"sourcesContent":[":host {\n  display: inline-block;\n  --panel-height: 75vh;\n  --panel-width: 11rem;\n}\n\n.dropdown {\n  position: relative;\n\n  &.dropdown--open {\n    .dropdown__positioner {\n      visibility: visible;\n      opacity: 1;\n      transform: scale(1);\n    }\n  }\n\n  &__trigger {\n    display: block;\n    cursor: pointer;\n    border-width: 0;\n    outline: none;\n    background-color: unset;\n  }\n\n  &--disabled,\n  &--disabled .dropdown__trigger {\n    cursor: not-allowed;\n  }\n}\n\n.dropdown__positioner {\n  position: absolute;\n  right: 0;\n  width: 100%;\n  z-index: var(--sc-z-index-dropdown);\n  opacity: 0;\n  visibility: hidden;\n  transform: scale(0.9);\n  min-width: var(--panel-width);\n}\n.dropdown__panel {\n  transform-origin: top left;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  max-height: var(--panel-height);\n  font-family: var(--sc-font-sans);\n  font-size: var(--sc-font-size-medium);\n  font-weight: var(--sc-font-weight-normal);\n  color: var(--color);\n  background-color: var(--sc-panel-background-color);\n  border: solid 1px var(--sc-panel-border-color);\n  border-radius: var(--sc-border-radius-medium);\n  box-shadow: var(--sc-shadow-large);\n  overflow: auto;\n  overscroll-behavior: none;\n  // pointer-events: none;\n  transition: var(--sc-transition-fast) opacity, var(--sc-transition-fast) transform;\n  z-index: 5;\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Positions\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n// .dropdown__panel {\n//   &.position--top-left {\n//     transform-origin: bottom left;\n//     bottom: 100%;\n//   }\n\n//   &.position--top-right {\n//     transform-origin: bottom right;\n//     bottom: 100%;\n//     left: auto;\n//     right: 0;\n//   }\n\n//   &.position--bottom-right {\n//     transform-origin: top right;\n//     left: auto;\n//     right: 0;\n//   }\n// }\n","import { Component, Element, Prop, Event, EventEmitter, Watch, State, h, Listen } from '@stencil/core';\nimport { autoUpdate, computePosition, flip, offset, shift, size } from '@floating-ui/dom';\nimport { ScMenu } from '../menu/sc-menu';\nimport { speak } from '@wordpress/a11y';\nimport { __ } from '@wordpress/i18n';\n\nlet itemIndex = 0;\nlet arrowFlag = '';\n\n/**\n * @part base - The elements base wrapper.\n * @part trigger - The trigger.\n * @part panel - The panel.\n */\n@Component({\n  tag: 'sc-dropdown',\n  styleUrl: 'dropdown.scss',\n  shadow: true,\n})\nexport class ScDropdown {\n  @Element() el: HTMLDivElement;\n  private panel?: HTMLElement;\n  private trigger?: HTMLElement;\n  private positioner?: HTMLDivElement;\n\n  private positionerCleanup: ReturnType<typeof autoUpdate> | undefined;\n\n  @Prop() clickEl?: HTMLElement;\n\n  /** Is this disabled. */\n  @Prop() disabled: boolean;\n\n  /** Indicates whether or not the dropdown is open. You can use this in lieu of the show/hide methods. */\n  @Prop({ reflect: true, mutable: true }) open?: boolean = false;\n\n  /** The placement of the dropdown panel */\n  @Prop() position: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n\n  /** The placement of the dropdown. */\n  @Prop({ reflect: true }) placement:\n    | 'top'\n    | 'top-start'\n    | 'top-end'\n    | 'bottom'\n    | 'bottom-start'\n    | 'bottom-end'\n    | 'right'\n    | 'right-start'\n    | 'right-end'\n    | 'left'\n    | 'left-start'\n    | 'left-end' = 'bottom-start';\n\n  /** The distance in pixels from which to offset the panel away from its trigger. */\n  @Prop() distance: number = 10;\n\n  /** The distance in pixels from which to offset the panel along its trigger. */\n  @Prop() skidding: number = 0;\n\n  /**\n   * Enable this option to prevent the panel from being clipped when the component is placed inside a container with\n   * `overflow: auto|scroll`.\n   */\n  @Prop() hoist: boolean = false;\n\n  /** Determines whether the dropdown should hide when a menu item is selected */\n  @Prop({ attribute: 'close-on-select', reflect: true }) closeOnSelect: boolean = true;\n\n  /** Emitted when the dropdown opens. Calling `event.preventDefault()` will prevent it from being opened. */\n  @Event() scShow: EventEmitter<void>;\n\n  /** Emitted when the dropdown closes. Calling `event.preventDefault()` will prevent it from being closed. */\n  @Event() scHide: EventEmitter<void>;\n\n  /* Internal visible state */\n  @State() isVisible: boolean;\n\n  @Watch('open')\n  handleOpenChange() {\n    this.open ? this.show() : this.hide();\n  }\n\n  handleOutsideClick(evt) {\n    const path = evt.composedPath();\n    if (\n      !path.some(item => {\n        return item === this.el;\n      })\n    ) {\n      this.open = false;\n    }\n  }\n\n  startPositioner() {\n    this.stopPositioner();\n    this.updatePositioner();\n    this.positionerCleanup = autoUpdate(this.trigger, this.positioner, this.updatePositioner.bind(this));\n  }\n\n  updatePositioner() {\n    if (!this.open || !this.trigger || !this.positioner) {\n      return;\n    }\n\n    computePosition(this.trigger, this.positioner, {\n      placement: this.placement,\n      middleware: [\n        offset({ mainAxis: this.distance, crossAxis: this.skidding }),\n        flip(),\n        shift(),\n        size({\n          apply: ({ availableWidth: width, availableHeight: height }) => {\n            // Ensure the panel stays within the viewport when we have lots of menu items\n            Object.assign(this.panel.style, {\n              maxWidth: `${width}px`,\n              maxHeight: `${height}px`,\n            });\n          },\n          padding: 8,\n        }),\n      ],\n      strategy: this.hoist ? 'fixed' : 'absolute',\n    }).then(({ x, y, placement }) => {\n      this.positioner.setAttribute('data-placement', placement);\n\n      Object.assign(this.positioner.style, {\n        position: this.hoist ? 'fixed' : 'absolute',\n        left: `${x}px`,\n        top: `${y}px`,\n        right: 'auto',\n      });\n    });\n  }\n\n  stopPositioner() {\n    if (this.positionerCleanup) {\n      this.positionerCleanup();\n      this.positionerCleanup = undefined;\n      this.positioner.removeAttribute('data-placement');\n    }\n  }\n\n  show() {\n    speak(__('Menu Selection Dropdown opened. Press Up/Down arrow to toggle between menu items.', 'surecart'), 'assertive');\n    this.scShow.emit();\n    // Prevent subsequent calls to the method, whether manually or triggered by the `open` watcher\n    if (this.isVisible) {\n      return;\n    }\n    this.isVisible = true;\n    this.open = true;\n    this.startPositioner();\n    this.panel.focus();\n  }\n\n  hide() {\n    speak(__('Menu Selection Dropdown closed.', 'surecart'), 'assertive');\n    this.scHide.emit();\n    // Prevent subsequent calls to the method, whether manually or triggered by the `open` watcher\n    if (!this.isVisible) {\n      return;\n    }\n    this.stopPositioner();\n    this.isVisible = false;\n    this.open = false;\n    const slotted = this.el.shadowRoot.querySelector('slot[name=\"trigger\"]') as HTMLSlotElement;\n    const trigger = slotted.assignedElements({ flatten: true })[0] as HTMLElement;\n    trigger.focus();\n  }\n\n  handleClick(e) {\n    if (this.closeOnSelect) {\n      const path = e.composedPath();\n      if (\n        path.some(item => {\n          return item.classList && item.classList.contains('menu-item');\n        })\n      ) {\n        this.open = false;\n      }\n    }\n  }\n\n  componentWillLoad() {\n    document.addEventListener('mousedown', evt => this.handleOutsideClick(evt));\n  }\n\n  /* Get the slotted menu */\n  getMenu() {\n    let slotted = this.el.shadowRoot.querySelector('slot') as HTMLSlotElement;\n    return slotted.assignedNodes().find(node => {\n      return node.nodeName === 'sc-menu';\n    }) as unknown as ScMenu;\n  }\n\n  getItems() {\n    return [...this.el.querySelectorAll<HTMLScMenuItemElement>('sc-menu-item')];\n  }\n\n  handleHide() {\n    this.open = false;\n    itemIndex = 0;\n    this.trigger.focus();\n  }\n\n  @Listen('keydown')\n  handleKeyDown(event: KeyboardEvent) {\n    const items = this.getItems();\n\n    // Tabbing out of the control closes it\n    if (event.key === 'Tab') {\n      if (this.open) {\n        this.handleHide();\n      }\n\n      return;\n    }\n\n    // Up/down opens the menu\n    if (['ArrowDown', 'ArrowUp'].includes(event.key)) {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n\n      // Show the menu if it's not already open\n      if (!this.open) {\n        this.open = true;\n      }\n\n      // Focus on a menu item\n      // Focus on a menu item\n      if (event.key === 'ArrowDown') {\n        if (arrowFlag == 'up') {\n          itemIndex = itemIndex + 2;\n        }\n        if (itemIndex > items.length - 1) {\n          itemIndex = 0;\n        }\n        items[itemIndex].setFocus();\n        arrowFlag = 'down';\n        itemIndex++;\n        return;\n      }\n\n      if (event.key === 'ArrowUp') {\n        if (arrowFlag == 'down') {\n          itemIndex = itemIndex - 2;\n        }\n        if (itemIndex < 0) {\n          itemIndex = items.length - 1;\n        }\n\n        items[itemIndex].setFocus();\n\n        arrowFlag = 'up';\n        itemIndex--;\n\n        return;\n      }\n    }\n\n    // Close select dropdown on Esc/Escape key\n    if (event.key === 'Escape') {\n      if (this.open) {\n        this.handleHide();\n      }\n      return;\n    }\n\n    // Open select dropdown with Enter\n    if (event.key === 'Enter') {\n      if (this.open) {\n        this.handleHide();\n      } else {\n        event.stopImmediatePropagation();\n        event.preventDefault();\n        this.open = true;\n      }\n    }\n\n    // don't open the menu when a CTRL/Command key is pressed\n    if (event.ctrlKey || event.metaKey) {\n      return;\n    }\n  }\n\n  render() {\n    return (\n      <div\n        part=\"base\"\n        class={{\n          'dropdown': true,\n          'dropdown--open': this.open,\n          'dropdown--disabled': this.disabled,\n        }}\n      >\n        <span\n          part=\"trigger\"\n          class=\"dropdown__trigger\"\n          ref={el => (this.trigger = el as HTMLElement)}\n          onClick={() => {\n            if (this.disabled) return;\n            if (this.open) {\n              this.hide();\n            } else {\n              setTimeout(() => {\n                this.show();\n              }, 0);\n            }\n          }}\n          aria-expanded={this.open ? 'true' : 'false'}\n          aria-haspopup=\"true\"\n        >\n          <slot name=\"trigger\"></slot>\n        </span>\n\n        {/* Position the panel with a wrapper since the popover makes use of translate. This let's us add animations\n        on the panel without interfering with the position. */}\n        <div class=\"dropdown__positioner\" ref={el => (this.positioner = el as HTMLDivElement)}>\n          <div\n            part=\"panel\"\n            class={{\n              'dropdown__panel': true,\n              'position--top-left': this.position === 'top-left',\n              'position--top-right': this.position === 'top-right',\n              'position--bottom-left': this.position === 'bottom-left',\n              'position--bottom-right': this.position === 'bottom-right',\n            }}\n            aria-orientation=\"vertical\"\n            tabindex=\"-1\"\n            onClick={e => this.handleClick(e)}\n            ref={el => (this.panel = el as HTMLElement)}\n          >\n            <slot></slot>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"],"version":3}