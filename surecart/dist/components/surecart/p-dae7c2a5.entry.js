import{r as o,h as i,F as s}from"./p-e97fde0a.js";import{s as e}from"./p-fab02ef6.js";import"./p-273a6ac5.js";import{s as t,c as n,f as r,e as l,b as a}from"./p-566c9487.js";import{e as d,s as c,u}from"./p-53e7f7d7.js";import{a as p}from"./p-6b5d827f.js";import{l as v,b as m}from"./p-1712c78c.js";import{a as f}from"./p-dd3464cd.js";import{a as h,M as y}from"./p-449324ed.js";import{c as w}from"./p-1f60f497.js";import{a as _}from"./p-401e165e.js";import{s as g}from"./p-3aa9debd.js";import{o as b}from"./p-95325ec5.js";import{c as j}from"./p-ff10bfbf.js";import{l as k}from"./p-d4e54db7.js";import"./p-03631502.js";import"./p-93127aa7.js";import"./p-9dbc54d6.js";import"./p-d3366af3.js";import"./p-830ab1a3.js";import"./p-ec182234.js";import"./p-3f6362a4.js";import"./p-4df6e0c5.js";import"./p-30eb50ff.js";import"./p-75e76c8c.js";const E=(o,i,s)=>d("set",((e,t,n)=>{if(e!==o)return;if(Array.isArray(i)){if(i.some((o=>JSON.stringify(t===null||t===void 0?void 0:t[o])!==JSON.stringify(n===null||n===void 0?void 0:n[o])))){return s(t,n)}}if(typeof i==="string"){if(JSON.stringify(t===null||t===void 0?void 0:t[i])===JSON.stringify(n===null||n===void 0?void 0:n[i]))return;return s(t===null||t===void 0?void 0:t[i],n===null||n===void 0?void 0:n[i])}}));const P=":host{display:block}";const C=P;const J=class{constructor(i){o(this,i);this.processorId=undefined;this.method=undefined;this.error=undefined;this.methods=undefined}componentWillLoad(){e.id="mollie";this.fetchMethods();E("checkout",["total_amount","subtotal_amount","currency","reusabled_payment_method_required","shipping_address"],(()=>this.fetchMethods()))}async fetchMethods(){var o;const i=c.checkout;if(!(i===null||i===void 0?void 0:i.currency))return;try{v("methods");const s=await f({path:_(`surecart/v1/processors/${this.processorId}/payment_method_types`,{amount:i===null||i===void 0?void 0:i.total_amount,country:((o=i===null||i===void 0?void 0:i.shipping_address)===null||o===void 0?void 0:o.country)||"us",currency:i===null||i===void 0?void 0:i.currency,...(i===null||i===void 0?void 0:i.reusable_payment_method_required)?{reusable:i===null||i===void 0?void 0:i.reusable_payment_method_required}:{},per_page:100})});t.methods=(s===null||s===void 0?void 0:s.data)||[]}catch(o){w(o);console.error(o)}finally{m("methods")}}renderLoading(){return i("sc-card",null,i("sc-skeleton",{style:{width:"50%",marginBottom:"0.5em"}}),i("sc-skeleton",{style:{width:"30%",marginBottom:"0.5em"}}),i("sc-skeleton",{style:{width:"60%",marginBottom:"0.5em"}}))}render(){var o,e,t;if(p("methods")&&!((o=n())===null||o===void 0?void 0:o.length)){return this.renderLoading()}if(!((e=c.checkout)===null||e===void 0?void 0:e.currency)){return this.renderLoading()}if(!((t=n())===null||t===void 0?void 0:t.length)){return i("sc-alert",{type:"warning",open:true},wp.i18n.__("No available payment methods","surecart")," ")}const d=r()?"sc-toggles":"div";return i(s,null,i(d,{collapsible:false,theme:"container"},(n()||[]).map((o=>i("sc-payment-method-choice",{"processor-id":"mollie","method-id":o===null||o===void 0?void 0:o.id,key:o===null||o===void 0?void 0:o.id},i("span",{slot:"summary",class:"sc-payment-toggle-summary"},!!(o===null||o===void 0?void 0:o.image)&&i("img",{src:o===null||o===void 0?void 0:o.image,"aria-hidden":"true"}),i("span",null,o===null||o===void 0?void 0:o.description)),i("sc-card",null,i("sc-payment-selected",{label:wp.i18n.sprintf(wp.i18n.__("%s selected for check out.","surecart"),o===null||o===void 0?void 0:o.description)},!!(o===null||o===void 0?void 0:o.image)&&i("img",{slot:"icon",src:o===null||o===void 0?void 0:o.image,style:{width:"32px"}}),wp.i18n.__("Another step will appear after submitting your order to complete your purchase details.","surecart")))))),i(h,{processor:l("mock")}),i(y,{methods:a()})),!!p("methods")&&i("sc-block-ui",{class:"busy-block-ui","z-index":9,style:{"--sc-block-ui-opacity":"0.4"}}))}};J.style=C;const S=class{constructor(i){o(this,i)}componentWillLoad(){this.unlistenToFormState=b("formState",(()=>{if("paying"===j()){this.confirm()}}))}disconnectedCallback(){this.unlistenToFormState()}async confirm(){var o,i,s,t;if((e===null||e===void 0?void 0:e.id)!=="paystack")return;if(!((i=(o=c===null||c===void 0?void 0:c.checkout)===null||o===void 0?void 0:o.payment_intent)===null||i===void 0?void 0:i.processor_data.paystack))return;if(((s=c===null||c===void 0?void 0:c.checkout)===null||s===void 0?void 0:s.status)==="paid")return;try{const{public_key:o,access_code:i}=(t=c===null||c===void 0?void 0:c.checkout)===null||t===void 0?void 0:t.payment_intent.processor_data.paystack;if(!o||!i){w({message:wp.i18n.sprintf(wp.i18n.__("Payment gateway configuration incomplete. Please ensure Paystack is properly configured for transactions.","surecart"))});return}const s=new g;await s.newTransaction({key:o,accessCode:i,onSuccess:async o=>{if((o===null||o===void 0?void 0:o.status)!=="success"){throw{message:wp.i18n.sprintf(wp.i18n.__("Paystack transaction could not be finished. Status: %s","surecart"),o===null||o===void 0?void 0:o.status)}}return u("PAID")},onClose:()=>u("REJECT")})}catch(o){w(o);console.error(o);u("REJECT")}}};const R=class{constructor(i){o(this,i);this.razorpayInstance=null;this.confirming=false}componentWillLoad(){k().then((o=>this.razorpayInstance=o)).catch((o=>w({message:o.message})));this.unlistenToFormState=b("formState",(()=>{if("paying"===j()){this.confirm()}}))}disconnectedCallback(){this.unlistenToFormState()}async confirm(){var o,i,s,t,n,r,l,a;if((e===null||e===void 0?void 0:e.id)!=="razorpay")return;if(!((s=(i=(o=c===null||c===void 0?void 0:c.checkout)===null||o===void 0?void 0:o.payment_intent)===null||i===void 0?void 0:i.processor_data)===null||s===void 0?void 0:s.razorpay))return;if(((t=c===null||c===void 0?void 0:c.checkout)===null||t===void 0?void 0:t.status)==="paid")return;if(this.confirming)return;this.confirming=true;try{const{external_intent_id:o,processor_data:i,reusable:s}=((n=c===null||c===void 0?void 0:c.checkout)===null||n===void 0?void 0:n.payment_intent)||{};const{public_key:e,customer_id:t}=(i===null||i===void 0?void 0:i.razorpay)||{};if(!o||!e){w({message:wp.i18n.sprintf(wp.i18n.__("Payment gateway configuration incomplete. Please ensure Razorpay is properly configured for transactions.","surecart"))});return}if(!this.razorpayInstance){this.razorpayInstance=await k()}const d=(r=c===null||c===void 0?void 0:c.checkout)===null||r===void 0?void 0:r.customer;const p=d?{...d.name&&{name:d.name},...d.email&&{email:d.email},...d.phone&&{contact:d.phone}}:undefined;let v={key:e,order_id:o,prefill:p,customer_id:t,recurring:s,handler:o=>{if(o===null||o===void 0?void 0:o.razorpay_payment_id){return u("PAID")}else{w({message:wp.i18n.__("Payment verification failed. Please contact support.","surecart")});u("REJECT")}},modal:{ondismiss:()=>{u("REJECT")}}};if((a=(l=window===null||window===void 0?void 0:window.wp)===null||l===void 0?void 0:l.hooks)===null||a===void 0?void 0:a.applyFilters){v=window.wp.hooks.applyFilters("surecart_razorpay_checkout_options",v)}const m=new this.razorpayInstance(v);m.on("payment.failed",(o=>{var i;w({message:((i=o===null||o===void 0?void 0:o.error)===null||i===void 0?void 0:i.description)||wp.i18n.__("Payment failed. Please try again.","surecart")});u("REJECT");console.error("payment.failed",o)}));m.open()}catch(o){w(o);console.error(o);u("REJECT")}finally{this.confirming=false}}};export{J as sc_checkout_mollie_payment,S as sc_checkout_paystack_payment_provider,R as sc_checkout_razorpay_payment_provider};
//# sourceMappingURL=p-dae7c2a5.entry.js.map