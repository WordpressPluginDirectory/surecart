import{r as i,c as t,h as s,F as e,H as o}from"./p-e97fde0a.js";import{a as n}from"./p-dd3464cd.js";import{f as l}from"./p-e677365e.js";import{a as d}from"./p-401e165e.js";import"./p-d3366af3.js";const c=":host{display:block;font-size:var(--sc-font-size-medium)}.close__button{position:absolute;top:0;right:0;font-size:22px}";const a=c;const r=class{constructor(s){i(this,s);this.scRequestClose=t(this,"scRequestClose",7);this.scRefresh=t(this,"scRefresh",7);this.open=undefined;this.protocol=undefined;this.subscription=undefined;this.reasons=undefined;this.reason=undefined;this.step="cancel";this.comment=undefined}close(){this.reset();this.trackAttempt();this.scRequestClose.emit("close-button")}reset(){var i;this.reason=null;this.step=((i=this.protocol)===null||i===void 0?void 0:i.preservation_enabled)?"survey":"cancel"}async trackAttempt(){var i,t;if(!((i=this.protocol)===null||i===void 0?void 0:i.preservation_enabled))return;await n({method:"PATCH",path:`surecart/v1/subscriptions/${(t=this.subscription)===null||t===void 0?void 0:t.id}/preserve`})}componentWillLoad(){this.reset()}render(){return s("sc-dialog",{key:"6eaf232211319195dcf4dbcb0ff88d051926b9d4",style:{"--width":this.step==="survey"?"675px":"500px","--body-spacing":"var(--sc-spacing-xxx-large)"},noHeader:true,open:this.open,onScRequestClose:()=>this.close()},s("div",{key:"43bf9d9266ef39b10c065915681ff66c17654e29",class:{cancel:true}},s("sc-button",{key:"f4960b5bb3d4fae0157cd22e7fbc943daadd5471",class:"close__button",type:"text",circle:true,onClick:()=>this.close()},s("sc-icon",{key:"022f6a05319958949e16f15327fa4a8274ac3436",name:"x"})),this.step==="cancel"&&s("sc-subscription-cancel",{key:"69eba1f3bd4d4acbc2bce804dbfba894e97a1a83",subscription:this.subscription,protocol:this.protocol,reason:this.reason,comment:this.comment,onScAbandon:()=>this.close(),onScCancelled:()=>{this.scRefresh.emit();this.reset();this.scRequestClose.emit("close-button")}}),this.step==="survey"&&s("sc-cancel-survey",{key:"39f74c743dd086dc5edb70a036c7982e74d08949",protocol:this.protocol,onScAbandon:()=>this.close(),onScSubmitReason:i=>{const{comment:t,reason:s}=i.detail;this.reason=s;this.comment=t;this.step=(s===null||s===void 0?void 0:s.coupon_enabled)?"discount":"cancel"}}),this.step==="discount"&&s("sc-cancel-discount",{key:"11b96e3b82b62cf248b1b2e40b8e95bb36f5fbfa",protocol:this.protocol,subscription:this.subscription,reason:this.reason,comment:this.comment,onScCancel:()=>this.step="cancel",onScPreserved:()=>{this.scRefresh.emit();this.reset();this.scRequestClose.emit("close-button")}})))}};r.style=a;const u=class{constructor(t){i(this,t);this.subscription=undefined;this.updatePaymentMethodUrl=undefined;this.period=undefined;this.loading=true;this.error=undefined;this.details=undefined}componentWillLoad(){this.fetch()}handleSubscriptionChange(){this.fetch()}async fetch(){var i,t,s;if(((i=this.subscription)===null||i===void 0?void 0:i.cancel_at_period_end)&&this.subscription.current_period_end_at){this.loading=false;return}if(((t=this.subscription)===null||t===void 0?void 0:t.status)==="canceled"){this.loading=false;return}try{this.loading=true;this.period=await n({method:"PATCH",path:d(`surecart/v1/subscriptions/${(s=this.subscription)===null||s===void 0?void 0:s.id}/upcoming_period`,{skip_product_group_validation:true,expand:["period.checkout","checkout.line_items","checkout.checkout_fees","checkout.shipping_fees","checkout.payment_method","checkout.manual_payment_method","payment_method.card","payment_method.payment_instrument","payment_method.paypal_account","payment_method.bank_account","line_item.price","line_item.fees","price.product","period.subscription"]}),data:{purge_pending_update:false}})}catch(i){console.error(i);this.error=i}finally{this.loading=false}}render(){var i,t,n,c,a,r,u;if(this.loading){return s("sc-toggle",{borderless:true,disabled:true},s("sc-flex",{slot:"summary",flexDirection:"column"},s("sc-skeleton",{style:{width:"200px"}}),s("sc-skeleton",{style:{width:"400px"}}),s("sc-skeleton",{style:{width:"300px"}})))}const p=(i=this===null||this===void 0?void 0:this.period)===null||i===void 0?void 0:i.checkout;if(!p)return s("div",{style:{padding:"var(--sc-spacing-medium)"}},s("sc-subscription-details",{slot:"summary",subscription:this.subscription}));const h=(p===null||p===void 0?void 0:p.manual_payment)?p===null||p===void 0?void 0:p.manual_payment_method:null;const v=(this===null||this===void 0?void 0:this.subscription.payment_method)||(this===null||this===void 0?void 0:this.subscription.manual_payment);const m=(t=p===null||p===void 0?void 0:p.checkout_fees)===null||t===void 0?void 0:t.data;const f=(n=p===null||p===void 0?void 0:p.shipping_fees)===null||n===void 0?void 0:n.data;return s(o,null,s("sc-toggle",{borderless:true,shady:true},s("span",{slot:"summary"},s("sc-subscription-details",{subscription:this.subscription},s("div",{style:{fontSize:"var(--sc-font-size-small)"}},wp.i18n.__("Your next payment is","surecart")," ",s("strong",null,p===null||p===void 0?void 0:p.amount_due_display_amount)," ",!!((c=this.subscription)===null||c===void 0?void 0:c.remaining_period_text)&&`â€” ${(a=this.subscription)===null||a===void 0?void 0:a.remaining_period_text}`))),s("sc-card",{noPadding:true,borderless:true},(r=p===null||p===void 0?void 0:p.line_items)===null||r===void 0?void 0:r.data.map((i=>{var t,e,o,n,l,d,c,a;return s("sc-product-line-item",{image:(e=(t=i.price)===null||t===void 0?void 0:t.product)===null||e===void 0?void 0:e.line_item_image,name:(n=(o=i.price)===null||o===void 0?void 0:o.product)===null||n===void 0?void 0:n.name,price:(l=i===null||i===void 0?void 0:i.price)===null||l===void 0?void 0:l.name,variant:i===null||i===void 0?void 0:i.variant_display_options,editable:false,removable:false,note:i===null||i===void 0?void 0:i.display_note,scratchDisplayAmount:i===null||i===void 0?void 0:i.scratch_display_amount,displayAmount:i===null||i===void 0?void 0:i.subtotal_display_amount,quantity:i===null||i===void 0?void 0:i.quantity,amount:i===null||i===void 0?void 0:i.subtotal_display_amount,interval:`${(d=i===null||i===void 0?void 0:i.price)===null||d===void 0?void 0:d.short_interval_text} ${(c=i===null||i===void 0?void 0:i.price)===null||c===void 0?void 0:c.short_interval_count_text}`,purchasableStatus:i===null||i===void 0?void 0:i.purchasable_status_display,fees:(a=i===null||i===void 0?void 0:i.fees)===null||a===void 0?void 0:a.data})})),s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Subtotal","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.subtotal_display_amount)),!!p.proration_amount&&s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Proration Credit","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.proration_display_amount)),!!p.applied_balance_amount&&s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Applied Balance","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.applied_balance_display_amount)),(m===null||m===void 0?void 0:m.length)>0&&s(e,null,m===null||m===void 0?void 0:m.map((i=>s("sc-line-item",null,s("span",{slot:"description"},i===null||i===void 0?void 0:i.description),s("span",{slot:"price"},i===null||i===void 0?void 0:i.display_amount))))),!!p.trial_amount&&s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Trial","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.trial_display_amount)),!!(p===null||p===void 0?void 0:p.discount_amount)&&s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Discounts","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.discounts_display_amount)),!!(p===null||p===void 0?void 0:p.shipping_amount)&&s(e,null,s("sc-line-item",{style:{marginTop:"var(--sc-spacing-small)"}},s("span",{slot:"description"},wp.i18n.__("Shipping","surecart")),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.shipping_display_amount)),(f===null||f===void 0?void 0:f.length)>0&&s(e,null,f===null||f===void 0?void 0:f.map((i=>s("sc-line-item",null,s("span",{slot:"description"},i===null||i===void 0?void 0:i.description),s("span",{slot:"price"},i===null||i===void 0?void 0:i.display_amount)))))),!!p.tax_amount&&s("sc-line-item",null,s("span",{slot:"description"},l(p===null||p===void 0?void 0:p.tax_label)),s("span",{slot:"price-description"},p===null||p===void 0?void 0:p.tax_display_amount)),s("sc-divider",{style:{"--spacing":"0"}}),s("sc-line-item",null,s("span",{slot:"description"},wp.i18n.__("Payment","surecart")),v&&s("a",{href:this.updatePaymentMethodUrl,slot:"price-description"},s("sc-flex",{"justify-content":"flex-start","align-items":"center",style:{"--spacing":"0.5em"}},h?s("sc-manual-payment-method",{paymentMethod:h}):s("sc-payment-method",{paymentMethod:p===null||p===void 0?void 0:p.payment_method}),s("sc-icon",{name:"edit-3"}))),!v&&s("a",{href:d(window.location.href,{action:"create",model:"payment_method",id:this===null||this===void 0?void 0:this.subscription.id,...((u=this===null||this===void 0?void 0:this.subscription)===null||u===void 0?void 0:u.live_mode)===false?{live_mode:false}:{}}),slot:"price-description"},wp.i18n.__("Add Payment Method","surecart"))),s("sc-line-item",{style:{"--price-size":"var(--sc-font-size-x-large)"}},s("span",{slot:"title"},wp.i18n.__("Total Due","surecart")),s("span",{slot:"price"},p===null||p===void 0?void 0:p.amount_due_display_amount),s("span",{slot:"currency"},p.currency)))))}static get watchers(){return{subscription:["handleSubscriptionChange"]}}};const p=class{constructor(s){i(this,s);this.scRequestClose=t(this,"scRequestClose",7);this.scRefresh=t(this,"scRefresh",7);this.open=undefined;this.subscription=undefined;this.busy=undefined;this.error=undefined;this.upcomingPeriod=undefined;this.loading=false}openChanged(){if(this.open){this.fetchUpcoming()}}async fetchUpcoming(){var i,t;this.loading=true;try{this.upcomingPeriod=await n({method:"PATCH",path:d(`surecart/v1/subscriptions/${(i=this.subscription)===null||i===void 0?void 0:i.id}/upcoming_period`,{skip_product_group_validation:true,expand:["period.checkout"]}),data:{purge_pending_update:false}})}catch(i){this.error=((t=i===null||i===void 0?void 0:i.additional_errors)===null||t===void 0?void 0:t.length)?i.additional_errors.map((i=>i.message)).join(", "):(i===null||i===void 0?void 0:i.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=false}}async reactivateSubscription(){var i,t;try{this.error="";this.busy=true;await n({path:`surecart/v1/subscriptions/${(i=this.subscription)===null||i===void 0?void 0:i.id}/restore`,method:"PATCH"});this.scRefresh.emit();this.scRequestClose.emit("close-button")}catch(i){this.error=((t=i===null||i===void 0?void 0:i.additional_errors)===null||t===void 0?void 0:t.length)?i.additional_errors.map((i=>i.message)).join(", "):(i===null||i===void 0?void 0:i.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=false}}renderLoading(){return s("sc-flex",{flexDirection:"column",style:{gap:"1em"}},s("sc-skeleton",{style:{width:"20%",display:"inline-block"}}),s("sc-skeleton",{style:{width:"60%",display:"inline-block"}}),s("sc-skeleton",{style:{width:"40%",display:"inline-block"}}))}render(){var i,t,o;return s("sc-dialog",{key:"6fdf846be161ede8705adc75eb28a20e34f77c05",noHeader:true,open:this.open,style:{"--width":"600px","--body-spacing":"var(--sc-spacing-xxx-large)"}},s("sc-dashboard-module",{key:"b12f075d9adca5adc19e8e45c680a1c1ac144450",loading:this.loading,heading:wp.i18n.__("Resubscribe","surecart"),class:"subscription-reactivate",error:this.error,style:{"--sc-dashboard-module-spacing":"1em"}},this.loading?this.renderLoading():s(e,null,s("div",{slot:"description"},s("sc-alert",{open:true,type:"warning",title:wp.i18n.__("Confirm Charge","surecart")},wp.i18n.__("You will be charged","surecart")," ",(t=(i=this.upcomingPeriod)===null||i===void 0?void 0:i.checkout)===null||t===void 0?void 0:t.amount_due_display_amount," ",wp.i18n.__("immediately for your subscription.","surecart")),s("sc-text",{style:{"--font-size":"var(--sc-font-size-medium)","--color":"var(--sc-input-label-color)","--line-height":"var(--sc-line-height-dense)","margin-top":"var(--sc-spacing-medium)"}},wp.i18n.__("Your subscription will be reactivated and will renew automatically on","surecart")," ",s("strong",null,(o=this.upcomingPeriod)===null||o===void 0?void 0:o.end_at_date))),s("sc-flex",{justifyContent:"flex-start"},s("sc-button",{type:"primary",loading:this.busy,disabled:this.busy,onClick:()=>this.reactivateSubscription()},wp.i18n.__("Yes, Reactivate","surecart")),s("sc-button",{disabled:this.busy,style:{color:"var(--sc-color-gray-500)"},type:"text",onClick:()=>this.scRequestClose.emit()},wp.i18n.__("No, Keep Inactive","surecart")))),this.busy&&s("sc-block-ui",{key:"4fbe8d68b6bfbb349c6b65ecc95eaf50da326c31"})))}static get watchers(){return{open:["openChanged"]}}};export{r as sc_cancel_dialog,u as sc_subscription_next_payment,p as sc_subscription_reactivate};
//# sourceMappingURL=p-6c97ef19.entry.js.map