import{r as e,h as t,H as i}from"./p-e97fde0a.js";import{a as s}from"./p-dd3464cd.js";import{l as a}from"./p-d4e54db7.js";import"./p-401e165e.js";import"./p-d3366af3.js";const n=".sc-razorpay-button-container{display:block}";const r=n;const d=class{constructor(t){e(this,t);this.razorpayInstance=null;this.confirming=false;this.liveMode=true;this.customerId=undefined;this.successUrl=undefined;this.currency=undefined;this.loading=undefined;this.loaded=undefined;this.error=undefined;this.paymentIntent=undefined}async handlePaymentIntentCreate(){if(this.confirming)return;const{external_intent_id:e,processor_data:t}=this.paymentIntent||{};const{public_key:i,customer_id:s}=(t===null||t===void 0?void 0:t.razorpay)||{};if(!i||!e)return;this.confirming=true;try{if(!this.razorpayInstance){this.razorpayInstance=await a()}const t={key:i,order_id:e,customer_id:s,recurring:true,handler:async e=>{if(e===null||e===void 0?void 0:e.razorpay_payment_id){window.location.assign(this.successUrl)}else{this.error=wp.i18n.__("Payment verification failed. Please contact support.","surecart");this.loading=false}},modal:{ondismiss:()=>{this.loading=false}}};const n=new this.razorpayInstance(t);n.on("payment.failed",(e=>{var t;this.error=((t=e===null||e===void 0?void 0:e.error)===null||t===void 0?void 0:t.description)||wp.i18n.__("Payment failed. Please try again.","surecart");this.loading=false;console.error("payment.failed",e)}));n.open()}catch(e){this.error=(e===null||e===void 0?void 0:e.message)||wp.i18n.__("Something went wrong","surecart");this.loading=false;console.error(e)}finally{this.confirming=false}}async createPaymentIntent(){var e,t;try{this.loading=true;this.error="";this.paymentIntent=await s({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"razorpay",reusable:true,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency,refresh_status:true}})}catch(i){console.error(i);this.error=((t=(e=i===null||i===void 0?void 0:i.additional_errors)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.message)||(i===null||i===void 0?void 0:i.message)||wp.i18n.__("Something went wrong","surecart");this.loading=false}}render(){return t(i,{key:"6bcb832576f72b55f6afe82bd5fb58458dc038cf"},this.error&&t("sc-alert",{key:"47ced5d3c826ae061dc20f2887970c8c3390d10e",open:!!this.error,type:"danger"},t("span",{key:"3099705723df5c40f705351a1864044355c69444",slot:"title"},wp.i18n.__("Error","surecart")),this.error),t("div",{key:"f3466ae0f222c2880619083c6662ca608deb7090",class:"sc-razorpay-button-container"},t("sc-alert",{key:"85d6d3fbb8260f83c5b345c1c26dc50f14fee3c8",open:true,type:"warning"},wp.i18n.__("In order to add a new card, we will need to make a small transaction to authenticate it. This is for authentication purposes and will be immediately refunded.","surecart"),t("div",{key:"b058c3d0b6eca9ae83a042329241d68cdcd234a5"},t("sc-button",{key:"88b66be329f78e8e1d1547070b6c7484b8cc3ccf",loading:this.loading,type:"primary",onClick:()=>this.createPaymentIntent(),style:{marginTop:"var(--sc-spacing-medium)"}},wp.i18n.__("Add New Card","surecart"))))))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};d.style=r;export{d as sc_razorpay_add_method};
//# sourceMappingURL=p-7115c10b.entry.js.map