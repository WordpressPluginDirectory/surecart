{"version":3,"file":"sc-popover.js","sourceRoot":"","sources":["../../../../src/components/ui/popover/sc-popover.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Prop, Event, EventEmitter, Watch, State, h } from '@stencil/core';\nimport { autoUpdate, computePosition, flip, offset, shift, size } from '@floating-ui/dom';\nimport { __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\n\n/**\n * @part base - The elements base wrapper.\n * @part trigger - The trigger.\n * @part panel - The panel.\n */\n@Component({\n  tag: 'sc-popover',\n  styleUrl: 'sc-popover.scss',\n  shadow: true,\n})\nexport class ScPopover {\n  @Element() el: HTMLDivElement;\n  private panel?: HTMLElement;\n  private trigger?: HTMLElement;\n  private positioner?: HTMLDivElement;\n\n  private positionerCleanup: ReturnType<typeof autoUpdate> | undefined;\n  private boundHandleOutsideClick = (evt: MouseEvent) => this.handleOutsideClick(evt);\n  private boundHandleKeyDown = (evt: KeyboardEvent) => this.handleKeyDown(evt);\n  private boundHandleFocusOut = (evt: FocusEvent) => this.handleFocusOut(evt);\n\n  /** Is this disabled. */\n  @Prop() disabled: boolean;\n\n  /** Indicates whether or not the popover is open. You can use this in lieu of the show/hide methods. */\n  @Prop({ reflect: true, mutable: true }) open?: boolean = false;\n\n  /** The placement of the popover. */\n  @Prop({ reflect: true }) placement:\n    | 'top'\n    | 'top-start'\n    | 'top-end'\n    | 'bottom'\n    | 'bottom-start'\n    | 'bottom-end'\n    | 'right'\n    | 'right-start'\n    | 'right-end'\n    | 'left'\n    | 'left-start'\n    | 'left-end' = 'bottom-start';\n\n  /** The distance in pixels from which to offset the panel away from its trigger. */\n  @Prop() distance: number = 0;\n\n  /** The distance in pixels from which to offset the panel along its trigger. */\n  @Prop() skidding: number = 0;\n\n  /**\n   * Enable this option to prevent the panel from being clipped when the component is placed inside a container with\n   * `overflow: auto|scroll`.\n   */\n  @Prop() hoist: boolean = false;\n\n  /** Emitted when the popover opens. Calling `event.preventDefault()` will prevent it from being opened. */\n  @Event() scShow: EventEmitter<void>;\n\n  /** Emitted when the popover closes. Calling `event.preventDefault()` will prevent it from being closed. */\n  @Event() scHide: EventEmitter<void>;\n\n  /* Internal visible state */\n  @State() isVisible: boolean;\n\n  @Watch('open')\n  handleOpenChange() {\n    this.open ? this.show() : this.hide();\n  }\n\n  handleOutsideClick(evt: MouseEvent) {\n    const path = evt.composedPath();\n    if (\n      !path.some(item => {\n        return item === this.el;\n      })\n    ) {\n      this.open = false;\n    }\n  }\n\n  handleKeyDown(event: KeyboardEvent) {\n    if (event.key === 'Escape') {\n      event.stopPropagation();\n      this.hide();\n    }\n  }\n\n  handleTriggerKeyDown(event: KeyboardEvent) {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      if (this.disabled) return;\n      if (this.open) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    }\n  }\n\n  /**\n   * Handles focus leaving the popover.\n   * Closes the popover if focus moves outside of it.\n   */\n  handleFocusOut(event: FocusEvent) {\n    const relatedTarget = event.relatedTarget as Node;\n    // If focus is moving to something outside the popover, close it\n    if (relatedTarget && !this.el.contains(relatedTarget)) {\n      this.open = false;\n    }\n  }\n\n  startPositioner() {\n    this.stopPositioner();\n    this.updatePositioner();\n    this.positionerCleanup = autoUpdate(this.trigger, this.positioner, this.updatePositioner.bind(this));\n  }\n\n  updatePositioner() {\n    if (!this.open || !this.trigger || !this.positioner) {\n      return;\n    }\n\n    computePosition(this.trigger, this.positioner, {\n      placement: this.placement,\n      middleware: [\n        offset({ mainAxis: this.distance, crossAxis: this.skidding }),\n        flip(),\n        shift(),\n        size({\n          apply: ({ availableWidth: width, availableHeight: height }) => {\n            // Ensure the panel stays within the viewport when we have lots of menu items\n            Object.assign(this.panel.style, {\n              maxWidth: `${width}px`,\n              maxHeight: `${height}px`,\n            });\n          },\n          padding: 8,\n        }),\n      ],\n      strategy: this.hoist ? 'fixed' : 'absolute',\n    }).then(({ x, y, placement }) => {\n      this.positioner.setAttribute('data-placement', placement);\n\n      Object.assign(this.positioner.style, {\n        position: this.hoist ? 'fixed' : 'absolute',\n        left: `${x}px`,\n        top: `${y}px`,\n        right: 'auto',\n      });\n    });\n  }\n\n  stopPositioner() {\n    if (this.positionerCleanup) {\n      this.positionerCleanup();\n      this.positionerCleanup = undefined;\n      this.positioner?.removeAttribute('data-placement');\n    }\n  }\n\n  show() {\n    speak(__('Popover opened. Press Escape to close.', 'surecart'), 'assertive');\n    this.scShow.emit();\n    // Prevent subsequent calls to the method, whether manually or triggered by the `open` watcher\n    if (this.isVisible) {\n      return;\n    }\n    this.isVisible = true;\n    this.open = true;\n    this.startPositioner();\n    document.addEventListener('keydown', this.boundHandleKeyDown);\n    this.el.addEventListener('focusout', this.boundHandleFocusOut);\n    this.panel.focus();\n  }\n\n  hide() {\n    speak(__('Popover closed.', 'surecart'), 'assertive');\n    this.scHide.emit();\n    // Prevent subsequent calls to the method, whether manually or triggered by the `open` watcher\n    if (!this.isVisible) {\n      return;\n    }\n    this.stopPositioner();\n    document.removeEventListener('keydown', this.boundHandleKeyDown);\n    this.el.removeEventListener('focusout', this.boundHandleFocusOut);\n    this.isVisible = false;\n    this.open = false;\n    const slotted = this.el.shadowRoot.querySelector('slot[name=\"trigger\"]') as HTMLSlotElement;\n    const trigger = slotted.assignedElements({ flatten: true })[0] as HTMLElement;\n    trigger?.focus?.();\n  }\n\n  componentWillLoad() {\n    document.addEventListener('mousedown', this.boundHandleOutsideClick);\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener('mousedown', this.boundHandleOutsideClick);\n    document.removeEventListener('keydown', this.boundHandleKeyDown);\n    this.el.removeEventListener('focusout', this.boundHandleFocusOut);\n  }\n\n  handleHide() {\n    this.open = false;\n    this.trigger.focus();\n  }\n\n  render() {\n    return (\n      <div\n        part=\"base\"\n        class={{\n          'popover': true,\n          'popover--open': this.open,\n          'popover--disabled': this.disabled,\n        }}\n      >\n        <span\n          part=\"trigger\"\n          class=\"popover__trigger\"\n          ref={el => (this.trigger = el as HTMLElement)}\n          onClick={() => {\n            if (this.disabled) return;\n            if (this.open) {\n              this.hide();\n            } else {\n              setTimeout(() => {\n                this.show();\n              }, 0);\n            }\n          }}\n          onKeyDown={e => this.handleTriggerKeyDown(e)}\n          tabindex=\"0\"\n          role=\"button\"\n          aria-expanded={this.open ? 'true' : 'false'}\n          aria-haspopup=\"dialog\"\n          aria-label={__('Press Enter to open popover', 'surecart')}\n        >\n          <slot name=\"trigger\"></slot>\n        </span>\n\n        {/* Position the panel with a wrapper since the popover makes use of translate. This let's us add animations\n        on the panel without interfering with the position. */}\n        <div class=\"popover__positioner\" ref={el => (this.positioner = el as HTMLDivElement)}>\n          <div\n            part=\"panel\"\n            class=\"popover__panel\"\n            role=\"dialog\"\n            aria-modal=\"false\"\n            tabindex=\"-1\"\n            ref={el => (this.panel = el as HTMLElement)}\n          >\n            <div class=\"popover__header\">\n              <slot name=\"title\" />\n              <button\n                type=\"button\"\n                class=\"popover__header-close-button\"\n                onClick={() => this.handleHide()}\n                onKeyDown={e => e.key === 'Enter' && this.handleHide()}\n                aria-label={__('Close', 'surecart')}\n              >\n                <sc-icon class=\"popover__header-close-icon\" name=\"x\" />\n              </button>\n            </div>\n            <slot name=\"content\"></slot>\n            <div class=\"popover__footer\">\n              <slot name=\"footer\"></slot>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"]}