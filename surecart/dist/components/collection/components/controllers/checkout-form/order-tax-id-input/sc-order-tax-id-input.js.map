{"version":3,"file":"sc-order-tax-id-input.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/order-tax-id-input/sc-order-tax-id-input.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Method, Prop, State, Watch } from '@stencil/core';\nimport { state as checkoutState } from '@store/checkout';\nimport { __ } from '@wordpress/i18n';\nimport { createOrUpdateCheckout } from '../../../../services/session';\n\nimport { Address, Checkout, TaxIdentifier } from '../../../../types';\nimport { formBusy } from '@store/form/getters';\nimport { createErrorNotice } from '@store/notices/mutations';\nimport { updateFormState } from '@store/form/mutations';\n\n@Component({\n  tag: 'sc-order-tax-id-input',\n  styleUrl: 'sc-order-tax-id-input.css',\n  shadow: true,\n})\nexport class ScOrderTaxIdInput {\n  /** The tax id input */\n  private input: HTMLScTaxIdInputElement;\n\n  /** Force show the field. */\n  @Prop() show: boolean = false;\n\n  /** Other zones label */\n  @Prop() otherLabel: string;\n\n  /** GST zone label */\n  @Prop() caGstLabel: string;\n\n  /** AU zone label */\n  @Prop() auAbnLabel: string;\n\n  /** UK zone label */\n  @Prop() gbVatLabel: string;\n\n  /** EU zone label */\n  @Prop() euVatLabel: string;\n\n  /** Help text */\n  @Prop() helpText: string;\n\n  /** Tax ID Types which will be shown Eg: '[\"eu_vat\", \"gb_vat\"]' */\n  @Prop() taxIdTypes: string | string[];\n\n  /** Whether tax input is required */\n  @Prop() required: boolean = false;\n\n  /** Tax ID Types data as array */\n  @State() taxIdTypesData: string[] = [];\n\n  @Watch('taxIdTypes')\n  handleTaxIdTypesChange() {\n    this.taxIdTypesData = typeof this.taxIdTypes === 'string' ? JSON.parse(this.taxIdTypes) : this.taxIdTypes;\n  }\n\n  @Method()\n  async reportValidity() {\n    return this.input.reportValidity();\n  }\n\n  getStatus() {\n    if (checkoutState.checkout?.tax_identifier?.number_type !== 'eu_vat') {\n      return 'unknown';\n    }\n    if (checkoutState.taxProtocol?.eu_vat_unverified_behavior === 'apply_reverse_charge') {\n      return 'unknown';\n    }\n    return (checkoutState.checkout?.tax_identifier as TaxIdentifier)?.eu_vat_verified ? 'valid' : 'invalid';\n  }\n\n  async updateOrder(tax_identifier: { number: string; number_type: string }) {\n    try {\n      updateFormState('FETCH');\n      checkoutState.checkout = (await createOrUpdateCheckout({\n        id: checkoutState.checkout.id,\n        data: { tax_identifier },\n      })) as Checkout;\n      updateFormState('RESOLVE');\n    } catch (e) {\n      console.error(e);\n      createErrorNotice(e);\n      updateFormState('REJECT');\n    }\n  }\n\n  componentWillLoad() {\n    this.handleTaxIdTypesChange();\n  }\n\n  isRequired() {\n    // If the block has explicitly set required, use that value.\n    if (this.required) {\n      return true;\n    }\n\n    // Only apply EU VAT requirement if eu_vat is one of the allowed tax types.\n    // If taxIdTypesData is empty, all types are allowed.\n    const isEuVatAllowed = !this.taxIdTypesData?.length || this.taxIdTypesData.includes('eu_vat');\n\n    // Fall back to EU VAT protocol requirement only if EU VAT is an allowed type.\n    return isEuVatAllowed && checkoutState.taxProtocol?.eu_vat_required && checkoutState.checkout?.tax_identifier?.number_type === 'eu_vat';\n  }\n\n  render() {\n    return (\n      <sc-tax-id-input\n        ref={el => (this.input = el as HTMLScTaxIdInputElement)}\n        show={this.show}\n        number={checkoutState.checkout?.tax_identifier?.number}\n        type={checkoutState.checkout?.tax_identifier?.number_type || this.taxIdTypesData?.[0] || 'eu_vat'}\n        country={(checkoutState.checkout?.shipping_address as Address)?.country}\n        status={this.getStatus()}\n        loading={formBusy()}\n        onScChange={e => {\n          e.stopImmediatePropagation();\n          this.updateOrder(e.detail);\n        }}\n        otherLabel={this.otherLabel}\n        caGstLabel={this.caGstLabel}\n        auAbnLabel={this.auAbnLabel}\n        gbVatLabel={this.gbVatLabel}\n        euVatLabel={this.euVatLabel}\n        help={this.helpText}\n        taxIdTypes={this.taxIdTypesData}\n        required={this.isRequired()}\n      ></sc-tax-id-input>\n    );\n  }\n}\n"]}