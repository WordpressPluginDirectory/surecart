{"version":3,"file":"sc-form-components-validator.spec.js","sourceRoot":"","sources":["../../../../../src/components/providers/form-components-validator/test/sc-form-components-validator.spec.tsx"],"names":[],"mappings":"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","sourcesContent":["// Mock the checkout store.\njest.mock('@store/checkouts/store', () => ({\n  __esModule: true,\n  default: {\n    state: { live: {}, test: {} },\n    set: jest.fn(),\n    get: jest.fn(),\n    onChange: jest.fn(),\n    on: jest.fn(),\n    dispose: jest.fn(),\n  },\n  state: { live: {}, test: {} },\n  set: jest.fn(),\n  get: jest.fn(),\n  onChange: jest.fn(),\n  on: jest.fn(),\n  dispose: jest.fn(),\n}));\n\n// Mock the checkout module\njest.mock('@store/checkout', () => ({\n  state: { checkout: null, formId: null },\n  onChange: jest.fn(() => jest.fn()), // Return a cleanup function\n}));\n\n// Mock the getters\njest.mock('@store/checkout/getters', () => ({\n  fullShippingAddressRequired: jest.fn(() => false),\n  shippingAddressRequired: jest.fn(() => false),\n}));\n\nimport { h } from '@stencil/core';\nimport { newSpecPage } from '@stencil/core/testing';\nimport { Checkout, TaxProtocol } from '../../../../types';\nimport { state as checkoutState } from '@store/checkout';\nimport { ScFormComponentsValidator } from '../sc-form-components-validator';\nimport { ScCustomerName } from '../../../controllers/checkout-form/customer-name/sc-customer-name';\nimport { ScOrderShippingAddress } from '../../../controllers/checkout-form/order-shipping-address/sc-order-shipping-address';\nimport { shippingAddressRequired } from '@store/checkout/getters';\n\n// Mock the getter functions\nconst mockShippingAddressRequired = shippingAddressRequired as jest.MockedFunction<typeof shippingAddressRequired>;\n\ndescribe('sc-form-components-validator', () => {\n  beforeEach(() => {\n    checkoutState.checkout = null;\n    checkoutState.formId = null;\n    mockShippingAddressRequired.mockReturnValue(false);\n    jest.clearAllMocks();\n  });\n\n  it('renders', async () => {\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator],\n      html: `<sc-form-components-validator></sc-form-components-validator>`,\n    });\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('appends missing address field if required', async () => {\n    mockShippingAddressRequired.mockReturnValue(true);\n\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator],\n      template: () => (\n        <sc-form-components-validator disabled={false}>\n          <sc-payment></sc-payment>\n        </sc-form-components-validator>\n      ),\n    });\n\n    // Wait for components to initialize\n    await page.waitForChanges();\n\n    checkoutState.checkout = { tax_status: 'address_invalid' } as Checkout;\n    await page.waitForChanges();\n\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('appends missing tax id input if required', async () => {\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator],\n      template: () => (\n        <sc-form-components-validator disabled={false} taxProtocol={{ tax_enabled: true, eu_vat_required: true } as TaxProtocol}>\n          <sc-payment></sc-payment>\n        </sc-form-components-validator>\n      ),\n    });\n    await page.waitForChanges();\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('appends missing trial line item if required', async () => {\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator],\n      template: () => (\n        <sc-form-components-validator disabled={false}>\n          <sc-order-summary>\n            <sc-line-item-total total=\"subtotal\"></sc-line-item-total>\n          </sc-order-summary>\n        </sc-form-components-validator>\n      ),\n    });\n    checkoutState.checkout = { trial_amount: 10 } as Checkout;\n    await page.waitForChanges();\n\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('appends missing address field with shipping address required', async () => {\n    mockShippingAddressRequired.mockReturnValue(true);\n\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator],\n      template: () => (\n        <sc-form-components-validator disabled={false}>\n          <sc-payment></sc-payment>\n        </sc-form-components-validator>\n      ),\n    });\n    checkoutState.checkout = { shipping_address_required: true } as Checkout;\n    await page.waitForChanges();\n\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('requires the customer name on sc-customer-name if present in page and shipping address required', async () => {\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator, ScCustomerName, ScOrderShippingAddress],\n      template: () => (\n        <sc-form-components-validator disabled={false}>\n          <sc-payment></sc-payment>\n          <sc-customer-name></sc-customer-name>\n          <sc-order-shipping-address></sc-order-shipping-address>\n        </sc-form-components-validator>\n      ),\n    });\n\n    // Wait for components to initialize\n    await page.waitForChanges();\n\n    // Set up the checkout state\n    checkoutState.checkout = { shipping_address_required: true } as Checkout;\n    await page.waitForChanges();\n\n    // Get the instance and trigger the handler\n    const instance = page.rootInstance as ScFormComponentsValidator;\n    instance.handleShippingAddressRequired();\n    await page.waitForChanges();\n\n    const customerName = page.root.querySelector('sc-customer-name');\n    expect(customerName.required).toBe(true);\n\n    const shippingAddressElement = page.root.querySelector('sc-order-shipping-address');\n    expect(shippingAddressElement.required).toBe(true);\n    expect(!!shippingAddressElement.requireName).toBe(false);\n    expect(!!shippingAddressElement.showName).toBe(false);\n\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n\n  it('requires the customer name on sc-order-shipping-address if shipping address is required', async () => {\n    const page = await newSpecPage({\n      components: [ScFormComponentsValidator, ScCustomerName, ScOrderShippingAddress],\n      template: () => (\n        <sc-form-components-validator disabled={false}>\n          <sc-payment></sc-payment>\n          <sc-order-shipping-address></sc-order-shipping-address>\n        </sc-form-components-validator>\n      ),\n    });\n\n    // Wait for components to initialize\n    await page.waitForChanges();\n\n    // Set up the checkout state\n    checkoutState.checkout = { shipping_address_required: true } as Checkout;\n    await page.waitForChanges();\n\n    // Get the instance and trigger the handler\n    const instance = page.rootInstance as ScFormComponentsValidator;\n    instance.handleShippingAddressRequired();\n    await page.waitForChanges();\n\n    const shippingAddressElement = page.root.querySelector('sc-order-shipping-address');\n    expect(shippingAddressElement.required).toBe(true);\n    expect(shippingAddressElement.requireName).toBe(true);\n    expect(shippingAddressElement.showName).toBe(true);\n\n    expect(page.root).toMatchSnapshot();\n    page.rootInstance.disconnectedCallback();\n  });\n});"]}